# Required Group Variables - iac-terraform-variables
# AGENT_POOL  (iac-terraform)
# BUILD_ARTIFACT_NAME  (iac-terraform)
# PIPELINE_ROOT_DIR  (pipelines)
# TF_ROOT_DIR (samples)
# TF_DEPLOYMENT_TEMPLATE_ROOT (samples)
# TF_VERSION (0.12.20)
# GO_VERSION (1.12.14)
# SERVICE_CONNECTION_NAME  <your_service_connection_name>
# REMOTE_STATE_ACCOUNT <your_remote_state_account_name>
# REMOTE_STATE_CONTAINER <your_remote_state_container_name>


trigger:
  batch: true
  branches:
    include:
    - master
  paths:
    include:
    - azure-pipeline.yml
    - /pipelines/*
    - /modules/*
    exclude:
    - /**/*.md

pr:
  branches:
    include:
    - '*'
  paths:
    include:
    - /pipelines/*
    exclude:
    - /**/*.md

variables:
- group: 'iac-terraform-variables'

stages:
- template: pipelines/compose-stages.yml
  parameters:
    environments:
    - name: 'dev'
      resourceNameIsolationLevel: 8
      enablePrIsolation: false
      skipTests: false

    configurations:
    - jobName: simpleweb
      terraformWorkspacePrefix: 'sw'
      terraformTemplatePath: 'samples/simpleweb'
      terraformModulePath: 'modules'
      deploymentTimeoutInMinutes: 20
      environmentsToTeardownAfterRelease:
      - 'dev'
